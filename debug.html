<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Rankings Data</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .section { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>üîç Debug Rankings Data</h1>
    
    <div class="section">
        <h2>Test API Endpoints</h2>
        <button onclick="testScrapeAndServe()">Test scrape-and-serve</button>
        <button onclick="testStaticFile()">Test rankings.json</button>
        <button onclick="clearResults()">Clear Results</button>
    </div>
    
    <div class="section">
        <h2>Results</h2>
        <div id="results">Click a button above to test...</div>
    </div>
    
    <script>
        async function testScrapeAndServe() {
            log('üöÄ Testing /.netlify/functions/scrape-and-serve...');
            
            try {
                const response = await fetch('/.netlify/functions/scrape-and-serve');
                log(`Response status: ${response.status}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log('‚úÖ Success! Data received:');
                    
                    // Log summary of each position
                    const positions = ['qb', 'rb', 'wr', 'te', 'flex', 'def', 'k'];
                    positions.forEach(pos => {
                        const count = data[pos] ? data[pos].length : 0;
                        log(`  ${pos.toUpperCase()}: ${count} players`);
                        
                        if (count > 0) {
                            log(`    First player: ${data[pos][0].player} (Rank ${data[pos][0].preGameRank})`);
                        }
                    });
                    
                    log('üìä Full data structure:');
                    log(JSON.stringify(data, null, 2));
                    
                } else {
                    log(`‚ùå Failed: ${response.status} ${response.statusText}`);
                    const text = await response.text();
                    log(`Response: ${text}`);
                }
                
            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
                console.error(error);
            }
        }
        
        async function testStaticFile() {
            log('üìÑ Testing ./rankings.json...');
            
            try {
                const response = await fetch('./rankings.json');
                log(`Response status: ${response.status}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log('‚úÖ Success! Static file data:');
                    
                    // Log summary
                    const positions = ['qb', 'rb', 'wr', 'te', 'flex', 'def', 'k'];
                    positions.forEach(pos => {
                        const count = data[pos] ? data[pos].length : 0;
                        log(`  ${pos.toUpperCase()}: ${count} players`);
                    });
                    
                    log(`Last updated: ${data.lastUpdated || 'Unknown'}`);
                    log(`Week: ${data.week || 'Unknown'}`);
                    
                } else {
                    log(`‚ùå Failed: ${response.status} ${response.statusText}`);
                }
                
            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
            }
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = 'Cleared.';
        }
        
        function log(message) {
            const results = document.getElementById('results');
            const timestamp = new Date().toISOString().slice(11, 19);
            results.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            console.log(message);
        }
        
        // Test automatically on load
        window.addEventListener('load', () => {
            log('üîß Debug page loaded. Click buttons to test endpoints.');
        });
    </script>
</body>
</html>